<h1>New order</h1>

<% form_for(@order) do |f| %>
  <%= f.error_messages %>


  <p>
  <ul class="inline-form">
    <li class="item"><div><%= f.label :status %></div></li>
    <li class="item"><div><%= f.label :registration_date %></div></li>
  </ul>
  <div class="clear"></div>
  <ul class="inline-form">
    <li class="item"><div><%= f.text_field :status %></div></li>
    <li class="item"><div><%= f.calendar_date_select :registration_date, :popup => :force%></div></li>
  </ul>
  <div class="clear"></div>
  </p>

  <div id="client">
    <%= render :partial => 'orders/client_form', :locals =>  { :client => @order.client }%>
  </div>

  <div id="products">
    <ul class="inline-form">
      <li class="item"><div>Quantity</div></li>
      <li class="item"><div>Name</div></li>
      <li class="item"><div>Description</div></li>
      <li class="item"><div>Unit Price</div></li>
      <li class="item"><div class="clear"></div></li>
    </ul>
    <div class="clear"></div>
    <%= render :partial => 'orders/product_presentation_form' %>
  </div>
  <p>
    <%= add_product_link "Add another product" %>
  </p>

  <p>
    <%= f.label :ammount %><br />
    <%= f.text_field :ammount %>
  </p>
  <p>
    <%= f.submit 'Create' %>
  </p>
<% end %>

<%= link_to 'Back', orders_path %>
<% content_for :javascript, javascript_include_tag("clients") -%>

<script type="text/javascript">
  js = <%= @product_presentations.to_json(:only => [:id, :description, :unit_price]) %>;

  function search(product_id){
    p = js.find(
    function(x){
      return x.product_presentation.id == product_id
    });
    
    $('product_presentation_description').setValue(p.product_presentation.description);
    $('order_new_order_product_presentations_attributes__unit_sold_price').setValue(p.product_presentation.unit_price);
  }

  function modifyTotal(a, b){
    $('order_new_order_product_presentations_attributes__unit_sold_price').up('.inline-form').down('li',4).down(0).value = a * b;
  }
</script>

